version: '3.8'

tasks:
  lint:
    desc: 'Lint and type check the code'
    cmds:
      - ruff format
      - ruff check --fix
      - mypy concert_db/ tests/

  test:
    desc: 'Run tests'
    cmd: pytest

  all:
    desc: 'Run all checks'
    ignore_error: true
    cmds:
      - task: lint
      - task: test

  app:
    env:
      ENVIRONMENT: '{{.ENVIRONMENT}}'
    cmd: python -m concert_db.app
    internal: true

  dev:
    desc: 'Run the application in development mode'
    cmds:
      - task: app
        vars:
          ENVIRONMENT: dev

  prd:
    desc: 'Run the application'
    cmds:
      - task: app
        vars:
          ENVIRONMENT: prod

  seed:
    env:
      ENVIRONMENT: dev
      PYTHONPATH: .
    desc: 'Seed the database with dummy data'
    cmds:
      - rm -f concert_db_dev.sqlite
      - uv run python -m scripts.add_sample_data

  shell:
    env:
      ENVIRONMENT: dev
    desc: 'Start a shell with database configured'
    cmd: ipython -i scripts/db_shell.py
